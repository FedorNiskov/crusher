### Общее описание

Этот пример демонстрирует фаззинг с символьным выполнением (DSE)
на основе частичной эмуляции (Dual-Emu),
целевое ПО предназначено для микроконтроллера STM-32
и работает с GSM-связью.

### Описание целевого ПО

Для STM-32 был подготовлен тестовый образ ПО,
который использует библиотеку для работы с GSM-связью
([https://github.com/nimaltd/gsm_v5.git](https://github.com/nimaltd/gsm_v5.git)).
Тестируемая часть библиотеки была адаптирована
для запуска в `qemu-system-arm`.
Начальная точка - вход в функцию `gsm_loop` (`fw/gsm_v5/gsm.c`),
конечная точка - возврат из неё.
Тестируемый код получает входные данные от функции `gsm_command`
(ответ на запрос `AT+CPIN?`), они будут записаны в буфер `str1`.
Ниже в код была вставлена искусственная ошибка -
разыменование некорректного указателя `bad_ptr`
(в случае "SIM PUK" в теле ответа).

Для сборки ПО нужно запустить скрипт:

```
./build.sh
```

Запуск ПО:

```
qemu-system-arm -M netduino2 -nographic -kernel firmware.bin -S -s
```

Последняя пара опций означает запуск с отладчиком GDB.
В другом терминале с GDB нужно дойти до начальной точки
и сделать снимок состояния (получить регистры и память).
Для этого можно использовать следующие команды:

```
$ gdb-multiarch
> set arch arm
> target remote :1234
> break * 0x000002F4
> continue
> info registers
> dump memory mem.rom 0x00000000 0x00010000
> dump memory mem.ram 0x20000000 0x20100000
```

В данном примере уже есть готовый образ ПО и снимок
(`fw/firmware.elf`, `fw/firmware.bin`, `dump`).

### Запуск эмуляции и фаззинга

Конкретное выполнение
(на экран будут печататься сообщения от ПО,
в случае crash-ошибки эмулятор сообщит об этом):

```
./python3 script.py --qiling -i input
```

Символьное выполнение
(в папке `out` будут сгенерированы
новые образцы входных данных):

```
./python3 script.py --angr -i input -o out
```

Запуск фаззинга с DSE
(см. `crashes` и `queue` в `out/EAT_OUT`):

```
./crusher/bin_x86-64/fuzz_manager --start 4 --eat-cores 1 --dse-cores 1 -i in -o out -I dualemu -T dualemu -t 15000 -- ./script.py
```

